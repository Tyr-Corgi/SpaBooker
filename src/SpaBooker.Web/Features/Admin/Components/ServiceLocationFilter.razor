@using SpaBooker.Core.Entities

@* Service Location Filter Component - Filter services by location *@

<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex align-items-center gap-2 flex-wrap">
            <strong class="text-muted me-2">Filter by Location:</strong>
            @foreach (var location in Locations.OrderBy(l => l.Name))
            {
                <div class="form-check form-check-inline">
                    <input class="form-check-input" 
                           type="checkbox" 
                           id="loc-@location.Id"
                           checked="@SelectedLocationIds.Contains(location.Id)"
                           @onchange="@((e) => HandleLocationChanged(location.Id, (bool)(e.Value ?? false)))">
                    <label class="form-check-label" for="loc-@location.Id">
                        <span class="badge bg-primary">@location.Name</span>
                    </label>
                </div>
            }
            @if (ShowClearButton)
            {
                <button class="btn btn-sm btn-outline-secondary ms-2" @onclick="OnClearFilters">
                    <i class="bi bi-x-circle"></i> Clear All Filters
                </button>
            }
        </div>
        @if (ShowFilterSummary)
        {
            <div class="mt-2">
                <small class="text-muted">@FilterSummaryText</small>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public List<Location> Locations { get; set; } = new();
    [Parameter] public HashSet<int> SelectedLocationIds { get; set; } = new();
    [Parameter] public bool ShowClearButton { get; set; }
    [Parameter] public bool ShowFilterSummary { get; set; }
    [Parameter] public string FilterSummaryText { get; set; } = string.Empty;
    [Parameter] public EventCallback<(int LocationId, bool IsSelected)> OnLocationFilterChanged { get; set; }
    [Parameter] public EventCallback OnClearFilters { get; set; }

    private async Task HandleLocationChanged(int locationId, bool isSelected)
    {
        await OnLocationFilterChanged.InvokeAsync((locationId, isSelected));
    }
}
